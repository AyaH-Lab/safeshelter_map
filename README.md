# Safeshelter Map

災害時の通信不安定な環境でも、最低限の避難情報を閲覧できることを目的としたWebアプリケーションです。

自治体が公開している防災関連オープンデータ(CSV)を活用し、避難所・避難場所・帰宅困難支援施設などの情報を検索・表示します。

本プロジェクトは、将来的に個人・各自治体や地域コミュニティが独自に展開・改修できることを前提とした、社会インフラ志向のオープンソースプロジェクトを目指しています。

---

## 背景

Python学習のアウトプットとして、CSVデータを利用した実用的なWebアプリケーションを制作したいと考えたことが本プロジェクトの出発点です。

当初は「オンラインで利用できる避難所検索アプリ」として設計を開始しましたが、開発途中で以下の疑問が生まれました。

- 災害時こそ通信が不安定になるのではないか？
- オフライン時でも動くべきではないのか？

この疑問がきっかけに、PWA化およびService Worker導入によるオフライン対応を実装しました。

---

## MVP要件

### 開発開始時の要件

- Django＋SQLite構成
- CSVデータの取り込み
- キーワード検索
- カテゴリ絞り込み
- Web公開

### 途中追加要件

- オフライン時でも最低限動作すること
- PWA対応
- Service Worker導入
- 一覧ページのオフライン表示保証

---

## 現在の仕様

### オンライン時

- キーワード検索可能
- カテゴリ絞り込み可能
- 最新データ取得(CSVデータの更新が必要)

### 物理オフライン時

- 一覧ページ表示のみ保証
- 新規検索は不可(検索ロジックがサーバー依存のため)

---

## 設計上の制約

検索処理はDjango＋SQLiteによるサーバーサイド実装となっているため、物理オフライン環境では新規検索を実行することができません。

DevToolsのOfflineモードでは検索が動作しているように見える場合がありますが、これはキャッシュされたHTMLが返却されているためであり、実際にデータベース検索が実行されているわけではありません。

---

## 技術構成

- Python
- Django
- SQLite
- HTML/CSS/JavaScript
- Service Worker
- PWA(manifest.json)
- PythonAnywhere(本番環境)

---

## 失敗と学び

### 要件定義の途中変更

開発途中で「完全オフライン検索」を目標に追加しました。
しかし、検索ロジックはサーバー依存構造であり、本来は以下の設計が必要でした。

- JSON API
- IndexedDB
- クライアントサイド検索

要件が変わると、システムの構造(アーキテクチャ)全体の再設計が必要になることを実体験として学びました。

---

### 本番環境とテスト環境の差

- DevTools Offlineと物理オフラインの挙動差
- HTTPキャッシュとService Workerキャッシュの違い
- ローカル環境とPythonAnywhere本番環境の差異

ローカルで動作することと、本番環境で安定動作することは別問題であることを実感しました。

---

### キャッシュ層の理解

ブラウザには複数のキャッシュが存在し、

- HTTPキャッシュ
- Service Worker Cache API

これらの挙動差がオフライン動作に影響することを学びました。

---

## 今後の改善予定

- JSON APIエンドポイントの実装
- IndexedDBによるデータ保持
- UI/UX改善
- CSV仕様の明文化
- 自治体別展開手順のドキュメント化

将来的には、個人・各自治体や地域コミュニティがフォークし、地域最適化された形で導入できる構造を目指します。

---

## 出典

本アプリは、船橋市オープンデータポータルで公開されている以下のオープンデータを加工・再構築して利用しています。

- 避難場所一覧
- 避難所(一時滞在可能)
- 帰宅困難者支援施設

出典：船橋市オープンデータポータル  
ライセンス：Creative Commons Attribution 4.0 International (CC BY 4.0)

---

## License

本プロジェクトは、公共性の高い利用を想定したオープンソースプロジェクトです。

将来的な拡張や自治体ごとの展開を前提とし、利用者間の知財トラブルを未然に防ぎ、安心して利用・改変・再配布できる環境を整えるため、特許条項を含む「Apache License 2.0」を採用しています。

詳細は`LICENSE`ファイルをご参照ください。

---

## 目指す姿

本プロジェクトは、特定の個人の所有物ではなく、各地域でフォークされ、実際の災害時に活用されることを理想としています。

技術の習得だけでなく、社会にとって意味のあるOSSとして成長させていきたいと考えています。