{% extends "base.html" %}
{% block title %}一覧{% endblock %}

{% block content %}
    <h1>避難施設一覧</h1>
    <form class="search-form" method="get" action="/places/">
        {# GETメソッドで/places/に検索ホームを送信 #}
        <label>
            カテゴリ：
            <select name="category">
                {# カテゴリ選択用のセレクトボックス。name="categry"がURLパラメータになる #}
                <option value="">すべて</option>
                {# カテゴリ未選択(全権表示)の選択肢 #}
                {% for c in categories %}
                {# Djangoテンプレート：categories(ビューから渡されたリスト)をループ #}
                    <option value="{{ c }}" {% if c == selected_category %}
                    selected
                    {% endif %}>
                    {# 現在選択中のカテゴリならselectedを付与 #}
                    {{ c }}
                    {# カテゴリ名を表示 #}
                    </option>
                {% endfor %}
                {# ループ終了 #}
            </select>
        </label>

        <label>
            キーワード：
            <input type="text" name="q" value="{{q}}" placeholder="施設名または住所"/>
            {# キーワード検索用のテキストボックス。valueに現在の検索語を保持 #}
        </label>

        <button type="submit">検索</button>
        {# 検索ボタン #}

        <a href="/places/">条件クリア</a>
        {# 検索条件をリセットして一覧に戻るリンク #}
    </form>

    <p>※検索は補助です。0件のときはカテゴリを「すべて」に戻して一覧から探せます。</p>
    {# ユーザー向けの注意書き #}

    <p>表示件数：{{ places | length }}件</p>
    {# 検索結果の件数を表示 #}

<ul class="place-list">
  {% for p in places %}
  <li class="place-card">
    <div class="place-card-header">
        <strong class="place-name">{{ p.name }}</strong>
        <span class="badge
            {% if p.category == '避難所' %}badge--shelter
            {% elif p.category == '避難場所' %}badge--site
            {% elif p.category == '帰宅困難者支援施設' %}badge--support
            {% else %}badge--other
            {% endif %}
            ">
            {{ p.category }}
        </span>
    </div>

    <p class="place-address">{{ p.address }}</p>

    <div class="place-actions">
        {% if p.map_url %}
            <a class="btn-map-large" href="{{ p.map_url }}" target="_blank" rel="noopener">
                地図を開く
            </a>
        {% else %}
            <span class="btn-map-large btn-disabled">
                地図情報なし
            </span>
        {% endif %}
        <a class="btn-detail" href="/places/{{ p.id }}/">詳細</a>
    </div>
  </li>
  {% empty %}
  <li>該当する施設が見つかりませんでした。条件を減らして再検索してください。</li>
  {% endfor %}
</ul>

{% endblock %}